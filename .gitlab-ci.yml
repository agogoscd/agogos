verify:
  image: maven:3.6-openjdk-11
  variables:
    MAVEN_OPTS: "-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository"
  cache:
    paths:
      - .m2/repository
  stage: test
  script:
    - mvn verify
  artifacts:
    when: always
    reports:
      junit:
        - ./**/target/surefire-reports/TEST-*.xml
        - ./**/target/failsafe-reports/TEST-*.xml
  only: [merge_requests]
  tags: [docker]

pages:
  image: antora/antora:2.3.4
  stage: deploy
  cache:
    paths:
      - .cache/
  script:
    - NODE_TLS_REJECT_UNAUTHORIZED=0 antora --fetch --cache-dir .cache/antora --to-dir public antora-playbook.yml
  artifacts:
    paths:
      - public
  only: [main]
  tags: [docker]
