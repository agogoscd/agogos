= Minikube Environment
CP Development Team <cp-devel@redhat.com>
:icons: font
:numbered:
:source-highlighter: highlightjs

This document describes the suggested local development setup.

== System requirements

Please make sure you have following requirements installed:

* link:https://minikube.sigs.k8s.io/docs/start/[Minikube]
** link:https://kubernetes.io/docs/tasks/tools/install-kubectl/[kubectl]
* link:https://tekton.dev/docs/getting-started/#installation[Tekton]
* link:https://sdkman.io/jdks#jdk.java.net[JDK 11]

== Gotchas

=== Managing contexts

Kubernetes contexts are managed globally. This means that any time you will have
one active context.

[NOTE]
====
Kubernetes documentation references:

* link:https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/[Organizing Cluster Access Using kubeconfig Files]
* link:https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/[Configure Access to Multiple Clusters]
====

After starting Minikube, the current context is switched to `minikube`. This means
that any commands executed using `kubectl` or `oc` will be run against your local
Minikube cluster.

There are many ways how multiple contexts can be managed, two of them:

1. Manage contexts with `kubectl config` commands
+
To switch to a different use the `kubectl config use-context` command.
To list all available contexts run `kubectl config get-contexts`.
2. Use separate kubeconfig files for different use cases
+
You can maintain the minikube context in a separate kubeconfig file.
This will make it possible to switch to Minikube context by setting an environment variable.
Run the below command to create (or update) your minikube context in specified file.
+
[source,bash]
----
❯ export KUBECONFIG=~/.kube/minikube.yaml
❯ minikube update-context
🎉  "minikube" context has been updated to point to 192.168.39.112:8443
💗  Current context is "minikube"
----
+
To use the Minikube context you will need to run `export KUBECONFIG=~/.kube/minikube.yaml`
in the terminal before interacting with the cluster.

== Known issues

This section describes known issues and limitations with the setup.

=== Minikube failing to start due to `PROVIDER_KVM2_ERROR`

If you see error similar to what can be found below, just start Minikube again. It will work.

[source,bash]
----
❯ minikube start
😄  minikube v1.17.1 on Fedora 33
✨  Using the kvm2 driver based on existing profile

💣  Exiting due to PROVIDER_KVM2_ERROR: /usr/bin/virsh domcapabilities --virttype kvm failed:

💡  Suggestion: Follow your Linux distribution instructions for configuring KVM
📘  Documentation: https://minikube.sigs.k8s.io/docs/reference/drivers/kvm2
----
